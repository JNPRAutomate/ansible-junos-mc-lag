{# this generates MC-LAG Aggregation specific config. It will be merged with the config generated by the common role before it is applied to the device #}
{# ICL Interface configuration #}
interfaces {
    {{ mclag.icl_interface }} {
        description "ICCP interface to Peer device";
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members {{ mclag_shared.iccp.vlan_id }};
                }
            }
        }
    }
{% for link in mclag.links.to_peer %}
    {{ link }} {
        ether-options {
            802.3ad {{ mclag.icl_interface }};
        }
    }
{% endfor %}
    {# IRB interface used for ICCP communication #}
    irb {
        unit  {{ mclag_shared.iccp.vlan_id }} {
            family inet {
                address {{ mclag.iccp.local_ip }}/24
            }
        }
    }
}
vlans {
    {{ mclag_shared.iccp.vlan_name }} {
        vlan-id {{ mclag_shared.iccp.vlan_id }}
        l3-interface irb.{{ mclag_shared.iccp.vlan_id }};
    }
}
{# ICCP Protocol Configuration #}
protocols {
    iccp {
        local-ip-addr {{ mclag.iccp.local_ip }};
        peer {{ mclag.iccp.peer_ip }} {
            redundancy-group-id-list 1;
            session-establishment-hold-time 50;
            liveness-detection {
                minimum-receive-interval 1000;
                transmit-interval {
                    minimum-interval 1000;
                }
            }
        }
    }
}
switch-options {
    service-id 10;
}
{#}
multicast-snooping-options {
    multichassis-lag-replicate-state;
}
#}

multi-chassis {
    multi-chassis-protection {{ mclag.iccp.peer_ip }} {
        interface {{ mclag.icl_interface }};
    }
}
